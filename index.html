<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kafka Security Controls | Conduktor</title>
  <meta name="description" content="118 Apache Kafka security controls mapped to CWE, NIST 800-53, and PCI-DSS standards">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Light theme - clean, professional, airy */
      --bg-page: #f8f9fb;
      --bg-surface: #ffffff;
      --bg-elevated: #ffffff;
      --bg-hover: #f3f4f6;
      --bg-inset: #f0f1f3;

      --border-subtle: #e5e7eb;
      --border-default: #d1d5db;
      --border-focus: #6366f1;

      --text-primary: #111827;
      --text-secondary: #4b5563;
      --text-muted: #9ca3af;

      /* Accent - indigo/violet */
      --accent: #6366f1;
      --accent-hover: #4f46e5;
      --accent-subtle: #eef2ff;

      /* Category colors - vibrant but balanced for light bg */
      --color-auth: #d97706;
      --color-enc: #059669;
      --color-authz: #7c3aed;
      --color-audit: #2563eb;
      --color-avail: #db2777;
      --color-net: #0891b2;
      --color-infra: #dc2626;
      --color-eco: #65a30d;
      --color-data: #9333ea;
      --color-ops: #ea580c;
      --color-mon: #0d9488;

      /* Framework badge colors - light theme optimized */
      --cwe-bg: #faf5ff;
      --cwe-text: #7c3aed;
      --cwe-border: #e9d5ff;

      --nist-bg: #eff6ff;
      --nist-text: #2563eb;
      --nist-border: #bfdbfe;

      --pci-bg: #fff7ed;
      --pci-text: #ea580c;
      --pci-border: #fed7aa;

      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;

      /* Typography */
      --font-mono: 'IBM Plex Mono', monospace;
      --font-sans: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;

      /* Effects */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.08);
      --shadow-focus: 0 0 0 3px rgba(99, 102, 241, 0.15);

      /* Border radius */
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --radius-full: 9999px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 15px;
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-page);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1440px;
      margin: 0 auto;
      padding: var(--space-xl);
    }

    /* Header */
    header {
      margin-bottom: var(--space-xl);
      padding-bottom: var(--space-xl);
      border-bottom: 1px solid var(--border-subtle);
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .logo-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--color-authz) 100%);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: var(--shadow-md);
    }

    h1 {
      font-family: var(--font-sans);
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: var(--text-primary);
    }

    h1 span {
      color: var(--text-muted);
      font-weight: 500;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
      margin-top: var(--space-xs);
    }

    .stats-row {
      display: flex;
      gap: var(--space-xl);
      margin-top: var(--space-lg);
      flex-wrap: wrap;
    }

    .stat {
      display: flex;
      align-items: baseline;
      gap: var(--space-sm);
    }

    .stat-value {
      font-family: var(--font-mono);
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .stat-label {
      color: var(--text-muted);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-weight: 500;
    }

    /* Search and filters */
    .controls-bar {
      display: flex;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      flex-wrap: wrap;
      align-items: stretch;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
      position: relative;
    }

    .search-box input {
      width: 100%;
      padding: 12px var(--space-md);
      padding-left: 44px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: var(--font-sans);
      font-size: 0.95rem;
      transition: all 0.15s ease;
      box-shadow: var(--shadow-sm);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--border-focus);
      box-shadow: var(--shadow-focus);
    }

    .search-box input::placeholder {
      color: var(--text-muted);
    }

    .search-box::before {
      content: "‚åò";
      position: absolute;
      left: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 1rem;
    }

    .filter-group {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 10px var(--space-md);
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-family: var(--font-sans);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      white-space: nowrap;
      box-shadow: var(--shadow-sm);
    }

    .filter-btn:hover {
      background: var(--bg-hover);
      border-color: var(--border-default);
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      box-shadow: var(--shadow-md);
    }

    /* Category pills */
    .category-filters {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-lg);
      flex-wrap: wrap;
    }

    .category-pill {
      padding: 6px var(--space-md);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      border: 1px solid transparent;
      opacity: 0.7;
    }

    .category-pill:hover,
    .category-pill.active {
      opacity: 1;
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .category-pill[data-category="Authentication"] { background: #fef3c7; color: var(--color-auth); border-color: #fcd34d; }
    .category-pill[data-category="Encryption"] { background: #d1fae5; color: var(--color-enc); border-color: #6ee7b7; }
    .category-pill[data-category="Authorization"] { background: #ede9fe; color: var(--color-authz); border-color: #c4b5fd; }
    .category-pill[data-category="Audit"] { background: #dbeafe; color: var(--color-audit); border-color: #93c5fd; }
    .category-pill[data-category="Availability"] { background: #fce7f3; color: var(--color-avail); border-color: #f9a8d4; }
    .category-pill[data-category="Network Security"] { background: #cffafe; color: var(--color-net); border-color: #67e8f9; }
    .category-pill[data-category="Infrastructure"] { background: #fee2e2; color: var(--color-infra); border-color: #fca5a5; }
    .category-pill[data-category="Ecosystem"] { background: #ecfccb; color: var(--color-eco); border-color: #bef264; }
    .category-pill[data-category="Data Protection"] { background: #f3e8ff; color: var(--color-data); border-color: #d8b4fe; }
    .category-pill[data-category="Operations"] { background: #ffedd5; color: var(--color-ops); border-color: #fdba74; }
    .category-pill[data-category="Monitoring"] { background: #ccfbf1; color: var(--color-mon); border-color: #5eead4; }

    /* Results count */
    .results-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .results-info strong {
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-weight: 600;
    }

    /* Controls grid */
    .controls-grid {
      display: grid;
      gap: var(--space-md);
    }

    .control-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      transition: all 0.2s ease;
      animation: fadeIn 0.3s ease forwards;
      opacity: 0;
      box-shadow: var(--shadow-sm);
    }

    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
      from { opacity: 0; transform: translateY(6px); }
    }

    .control-card:hover {
      border-color: var(--border-default);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-md);
      margin-bottom: var(--space-md);
    }

    .control-id {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-muted);
      background: var(--bg-inset);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      letter-spacing: 0.01em;
    }

    .control-category {
      font-size: 0.75rem;
      font-weight: 600;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
    }

    .control-category[data-category="Authentication"] { background: #fef3c7; color: var(--color-auth); }
    .control-category[data-category="Encryption"] { background: #d1fae5; color: var(--color-enc); }
    .control-category[data-category="Authorization"] { background: #ede9fe; color: var(--color-authz); }
    .control-category[data-category="Audit"] { background: #dbeafe; color: var(--color-audit); }
    .control-category[data-category="Availability"] { background: #fce7f3; color: var(--color-avail); }
    .control-category[data-category="Network Security"] { background: #cffafe; color: var(--color-net); }
    .control-category[data-category="Infrastructure"] { background: #fee2e2; color: var(--color-infra); }
    .control-category[data-category="Ecosystem"] { background: #ecfccb; color: var(--color-eco); }
    .control-category[data-category="Data Protection"] { background: #f3e8ff; color: var(--color-data); }
    .control-category[data-category="Operations"] { background: #ffedd5; color: var(--color-ops); }
    .control-category[data-category="Monitoring"] { background: #ccfbf1; color: var(--color-mon); }

    .control-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: var(--space-xs);
      color: var(--text-primary);
    }

    .control-section {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: var(--space-md);
    }

    .control-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.7;
      margin-bottom: var(--space-lg);
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--space-md);
      padding-top: var(--space-md);
      border-top: 1px solid var(--border-subtle);
    }

    .framework-badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .badge {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      font-weight: 500;
      padding: 3px 8px;
      border-radius: var(--radius-sm);
      letter-spacing: 0.01em;
    }

    .badge-cwe {
      background: var(--cwe-bg);
      color: var(--cwe-text);
      border: 1px solid var(--cwe-border);
    }

    .badge-nist {
      background: var(--nist-bg);
      color: var(--nist-text);
      border: 1px solid var(--nist-border);
    }

    .badge-pci {
      background: var(--pci-bg);
      color: var(--pci-text);
      border: 1px solid var(--pci-border);
    }

    .doc-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      color: var(--accent);
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 500;
      transition: color 0.15s ease;
    }

    .doc-link:hover {
      color: var(--accent-hover);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: var(--space-2xl);
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: var(--space-md);
      opacity: 0.5;
    }

    /* Footer */
    footer {
      margin-top: var(--space-2xl);
      padding-top: var(--space-xl);
      border-top: 1px solid var(--border-subtle);
      text-align: center;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-2xl);
      color: var(--text-muted);
    }

    .loading::after {
      content: "";
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-subtle);
      border-top-color: var(--accent);
      border-radius: 50%;
      margin-left: var(--space-md);
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      html { font-size: 14px; }
      .container { padding: var(--space-md); }
      .stats-row { gap: var(--space-md); }
      .stat-value { font-size: 1.5rem; }
      .search-box { min-width: 100%; }
      .control-card { padding: var(--space-md); }
    }

    /* Keyboard shortcut hint */
    .kbd {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      background: var(--bg-inset);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 2px 6px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-row">
        <div class="logo-icon">üîê</div>
        <div>
          <h1>Kafka Security Controls <span>/ conduktor</span></h1>
          <p class="subtitle">Comprehensive security controls mapped to CWE, NIST 800-53 & PCI-DSS</p>
        </div>
      </div>

      <div class="stats-row">
        <div class="stat">
          <span class="stat-value" id="total-controls">--</span>
          <span class="stat-label">Controls</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="total-categories">--</span>
          <span class="stat-label">Categories</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="total-cwe">--</span>
          <span class="stat-label">CWE Refs</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="total-nist">--</span>
          <span class="stat-label">NIST Refs</span>
        </div>
      </div>
    </header>

    <div class="controls-bar">
      <div class="search-box">
        <input type="text" id="search" placeholder="Search controls, CWE, NIST, PCI..." autocomplete="off">
      </div>

      <div class="filter-group">
        <button class="filter-btn" data-framework="cwe">CWE</button>
        <button class="filter-btn" data-framework="nist">NIST</button>
        <button class="filter-btn" data-framework="pci">PCI-DSS</button>
      </div>
    </div>

    <div class="category-filters" id="category-filters"></div>

    <div class="results-info">
      <span>Showing <strong id="visible-count">--</strong> of <strong id="total-count">--</strong> controls</span>
      <span>Press <span class="kbd">/</span> to search</span>
    </div>

    <div class="controls-grid" id="controls-grid">
      <div class="loading">Loading controls</div>
    </div>

    <footer>
      <p>
        Part of <a href="https://www.opencre.org" target="_blank" rel="noopener">OpenCRE</a> ecosystem
        ¬∑ <a href="https://github.com/conduktor/kafka-security-controls" target="_blank" rel="noopener">GitHub</a>
        ¬∑ <a href="https://conduktor.io" target="_blank" rel="noopener">Conduktor</a>
      </p>
      <p style="margin-top: var(--space-sm); opacity: 0.6;">Licensed under CC BY 4.0</p>
    </footer>
  </div>

  <script>
    // State
    let controls = [];
    let activeCategories = new Set();
    let activeFrameworks = new Set();
    let searchQuery = '';

    // Parse CSV
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = parseCSVLine(lines[0]);
      return lines.slice(1).map(line => {
        const values = parseCSVLine(line);
        const obj = {};
        headers.forEach((h, i) => obj[h] = values[i] || '');
        return obj;
      }).filter(row => row.sectionID);
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;

      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      result.push(current.trim());
      return result;
    }

    // Render
    function renderControls() {
      const grid = document.getElementById('controls-grid');
      const filtered = filterControls();

      document.getElementById('visible-count').textContent = filtered.length;

      if (filtered.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üîç</div>
            <p>No controls match your filters</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = filtered.map((c, i) => `
        <div class="control-card" style="animation-delay: ${Math.min(i * 20, 300)}ms">
          <div class="card-header">
            <span class="control-id">${escapeHtml(c.sectionID)}</span>
            <span class="control-category" data-category="${escapeHtml(c.category)}">${escapeHtml(c.category)}</span>
          </div>
          <h3 class="control-title">${escapeHtml(c.subsection)}</h3>
          <p class="control-section">${escapeHtml(c.section)}</p>
          <p class="control-description">${escapeHtml(c.description)}</p>
          <div class="card-footer">
            <div class="framework-badges">
              ${c.cwe_ids ? c.cwe_ids.split(',').map(id =>
                `<span class="badge badge-cwe" title="CWE-${id.trim()}">CWE-${id.trim()}</span>`
              ).join('') : ''}
              ${c.nist_refs ? c.nist_refs.split(',').map(ref =>
                `<span class="badge badge-nist" title="NIST ${ref.trim()}">${ref.trim()}</span>`
              ).join('') : ''}
              ${c.pci_refs ? c.pci_refs.split(',').map(ref =>
                `<span class="badge badge-pci" title="PCI-DSS ${ref.trim()}">PCI ${ref.trim()}</span>`
              ).join('') : ''}
            </div>
            ${c.hyperlink ? `<a href="${escapeHtml(c.hyperlink)}" target="_blank" rel="noopener" class="doc-link">Docs ‚Üí</a>` : ''}
          </div>
        </div>
      `).join('');
    }

    function filterControls() {
      return controls.filter(c => {
        // Category filter
        if (activeCategories.size > 0 && !activeCategories.has(c.category)) {
          return false;
        }

        // Framework filter
        if (activeFrameworks.size > 0) {
          const hasCWE = activeFrameworks.has('cwe') && c.cwe_ids;
          const hasNIST = activeFrameworks.has('nist') && c.nist_refs;
          const hasPCI = activeFrameworks.has('pci') && c.pci_refs;
          if (!hasCWE && !hasNIST && !hasPCI) return false;
        }

        // Search filter
        if (searchQuery) {
          const q = searchQuery.toLowerCase();
          const searchable = [
            c.sectionID, c.section, c.subsection, c.description,
            c.cwe_ids, c.nist_refs, c.pci_refs, c.category
          ].join(' ').toLowerCase();
          return searchable.includes(q);
        }

        return true;
      });
    }

    function renderCategoryFilters() {
      const categories = [...new Set(controls.map(c => c.category))].sort();
      const container = document.getElementById('category-filters');

      container.innerHTML = categories.map(cat => `
        <button class="category-pill" data-category="${escapeHtml(cat)}">${escapeHtml(cat)}</button>
      `).join('');

      container.querySelectorAll('.category-pill').forEach(btn => {
        btn.addEventListener('click', () => {
          const cat = btn.dataset.category;
          if (activeCategories.has(cat)) {
            activeCategories.delete(cat);
            btn.classList.remove('active');
          } else {
            activeCategories.add(cat);
            btn.classList.add('active');
          }
          renderControls();
        });
      });
    }

    function updateStats() {
      const uniqueCWE = new Set();
      const uniqueNIST = new Set();

      controls.forEach(c => {
        if (c.cwe_ids) c.cwe_ids.split(',').forEach(id => uniqueCWE.add(id.trim()));
        if (c.nist_refs) c.nist_refs.split(',').forEach(ref => uniqueNIST.add(ref.trim()));
      });

      document.getElementById('total-controls').textContent = controls.length;
      document.getElementById('total-count').textContent = controls.length;
      document.getElementById('total-categories').textContent = new Set(controls.map(c => c.category)).size;
      document.getElementById('total-cwe').textContent = uniqueCWE.size;
      document.getElementById('total-nist').textContent = uniqueNIST.size;
    }

    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    // Event listeners
    document.getElementById('search').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderControls();
    });

    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const fw = btn.dataset.framework;
        if (activeFrameworks.has(fw)) {
          activeFrameworks.delete(fw);
          btn.classList.remove('active');
        } else {
          activeFrameworks.add(fw);
          btn.classList.add('active');
        }
        renderControls();
      });
    });

    // Keyboard shortcut
    document.addEventListener('keydown', (e) => {
      if (e.key === '/' && document.activeElement.tagName !== 'INPUT') {
        e.preventDefault();
        document.getElementById('search').focus();
      }
      if (e.key === 'Escape') {
        document.getElementById('search').blur();
      }
    });

    // Load data
    async function init() {
      try {
        const response = await fetch('kafka_security_controls.csv');
        const text = await response.text();
        controls = parseCSV(text);
        updateStats();
        renderCategoryFilters();
        renderControls();
      } catch (err) {
        document.getElementById('controls-grid').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <p>Failed to load controls: ${escapeHtml(err.message)}</p>
          </div>
        `;
      }
    }

    init();
  </script>
</body>
</html>
